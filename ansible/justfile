
inventory := "./inventory/hosts.ini"
playbook_dir := "./playbooks"

default:
    @just --list

# ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã®å†…å®¹ã‚’è¡¨ç¤º
inventory:
    ansible-inventory -i {{inventory}} --list

# æ¥ç¶šãƒ†ã‚¹ãƒˆ (ping)
ping:
    ansible -i {{inventory}} all -m ping

# ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯å®Ÿè¡Œ
play PLAYBOOK:
    ansible-playbook -i {{inventory}} {{playbook_dir}}/{{PLAYBOOK}}

# ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯å®Ÿè¡Œï¼ˆè©³ç´°ãƒ­ã‚°ï¼‰
play-verbose PLAYBOOK:
    ansible-playbook -i {{inventory}} {{playbook_dir}}/{{PLAYBOOK}} -vvv

# ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯å®Ÿè¡Œï¼ˆãƒã‚§ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼‰
play-check PLAYBOOK:
    ansible-playbook -i {{inventory}} {{playbook_dir}}/{{PLAYBOOK}} --check

install:
    ansible-playbook -i {{inventory}} {{playbook_dir}}/install-packages.yml

maintenance:
    ansible-playbook -i {{inventory}} {{playbook_dir}}/maintenance-security.yml

deploy:
    ansible-playbook -i {{inventory}} {{playbook_dir}}/deploy-stack.yml

# ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ§‹æ–‡ãƒã‚§ãƒƒã‚¯
check-inventory:
    ansible-inventory -i {{inventory}} --list > /dev/null && echo "âœ… Inventory syntax is valid"

# ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
check-playbook PLAYBOOK:
    ansible-playbook -i {{inventory}} {{playbook_dir}}/{{PLAYBOOK}} --syntax-check

# å…¨ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
check-all:
    #!/usr/bin/env bash
    echo "ğŸ” Checking all playbooks..."
    for playbook in {{playbook_dir}}/*.yml; do
        if [ -f "$playbook" ]; then
            echo "Checking $(basename $playbook)..."
            ansible-playbook -i {{inventory}} "$playbook" --syntax-check
        fi
    done
    echo "âœ… All playbooks checked"
